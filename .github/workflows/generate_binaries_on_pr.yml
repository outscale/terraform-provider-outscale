# This GitHub action can generate binaries for the PR and upload them for future use
name: Generate binaries on PR
on:
    pull_request:
        branches:
            - master
        paths:
            - "**.go"
            - "**.sum"
            - "**.mod"
            - "GNUmakefile"
    workflow_dispatch:

jobs:
    goreleaser:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
              with:
                  fetch-depth: 0
            - name: Set up Go
              uses: actions/setup-go@7a3fe6cf4cb3a834922a1244abfce67bcef6a0c5 # v6
              with:
                  go-version-file: "./go.mod"
            - name: Run GoReleaser
              uses: goreleaser/goreleaser-action@5742e2a039330cbb23ebf35f046f814d4c6ff811 # v5
              with:
                  version: latest
                  args: build --rm-dist --snapshot
            - name: Upload assets
              uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
              with:
                  name: terraform-provider-outscale
                  path: dist/terraform-provider-outscale*
